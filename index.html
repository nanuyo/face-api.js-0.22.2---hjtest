<!DOCTYPE html>
<html>

<head>
  <script src="face-api.js"></script>
  <script src="js/commons.js"></script>
  <script src="js/faceDetectionControls.js"></script>
  <script src="js/imageSelectionControls.js"></script>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="lotto.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
</head>

<body>
  <div id="navbar"></div>
  <div class="center-content page-container">

    <div class="progress" id="loader">
      <div class="indeterminate"></div>
    </div>
    <div style="position: relative" class="margin">
      <img id="inputImg" src="" style="max-width: 800px;" />
      <canvas id="overlay" />
    </div>

    <div class="row side-by-side">
      <!-- <h1 id="print_lottonum">Lotto numbers</h1> -->
      <p id="pprint_lottonum">
        <span id="span1_id" class="ball_645 lrg ball1">2</span>
        <span id="span2_id" class="ball_645 lrg ball2">13</span>
        <span id="span3_id" class="ball_645 lrg ball3">16</span>
        <span id="span4_id" class="ball_645 lrg ball4">19</span>
        <span id="span5_id" class="ball_645 lrg ball5">32</span>
        <span id="span6_id" class="ball_645 lrg ball6">33</span>
      </p>

      <!-- image_selection_control -->
      <div id="selectList"></div>
      <div class="row">
        <label for="imgUrlInput">Get image from URL:</label>
        <input id="imgUrlInput" type="text" class="bold">
      </div>
      <button class="waves-effect waves-light btn" onclick="loadImageFromUrl()">
        Ok
      </button>
      <input id="queryImgUploadInput" type="file" class="waves-effect btn bold" onchange="loadImageFromUpload()"
        accept=".jpg, .jpeg, .png">
      <!-- image_selection_control -->
    </div>

    <div class="row side-by-side">

      <!-- face_detector_selection_control -->
      <div id="face_detector_selection_control" class="row input-field" style="margin-right: 20px;">
        <select id="selectFaceDetector">
          <option value="ssd_mobilenetv1">SSD Mobilenet V1</option>
          <option value="tiny_face_detector">Tiny Face Detector</option>
        </select>
        <label>Select Face Detector</label>
      </div>
      <!-- face_detector_selection_control -->

      <!-- check boxes -->
      <div class="row" style="width: 220px;">
        <input type="checkbox" id="hideBoundingBoxesCheckbox" onchange="onChangeHideBoundingBoxes(event)" />
        <label for="hideBoundingBoxesCheckbox">Hide Bounding Boxes</label>
      </div>
      <!-- check boxes -->

    </div>

    <!-- ssd_mobilenetv1_controls -->
    <span id="ssd_mobilenetv1_controls">
      <div class="row side-by-side">
        <div class="row">
          <label for="minConfidence">Min Confidence:</label>
          <input disabled value="0.5" id="minConfidence" type="text" class="bold">
        </div>
        <button class="waves-effect waves-light btn" onclick="onDecreaseMinConfidence()">
          <i class="material-icons left">-</i>
        </button>
        <button class="waves-effect waves-light btn" onclick="onIncreaseMinConfidence()">
          <i class="material-icons left">+</i>
        </button>
      </div>
    </span>
    <!-- ssd_mobilenetv1_controls -->

    <!-- tiny_face_detector_controls -->
    <span id="tiny_face_detector_controls">
      <div class="row side-by-side">
        <div class="row input-field" style="margin-right: 20px;">
          <select id="inputSize">
            <option value="" disabled selected>Input Size:</option>
            <option value="160">160 x 160</option>
            <option value="224">224 x 224</option>
            <option value="320">320 x 320</option>
            <option value="416">416 x 416</option>
            <option value="512">512 x 512</option>
            <option value="608">608 x 608</option>
          </select>
          <label>Input Size</label>
        </div>
        <div class="row">
          <label for="scoreThreshold">Score Threshold:</label>
          <input disabled value="0.5" id="scoreThreshold" type="text" class="bold">
        </div>
        <button class="waves-effect waves-light btn" onclick="onDecreaseScoreThreshold()">
          <i class="material-icons left">-</i>
        </button>
        <button class="waves-effect waves-light btn" onclick="onIncreaseScoreThreshold()">
          <i class="material-icons left">+</i>
        </button>
      </div>
    </span>
    <!-- tiny_face_detector_controls -->

</body>

<script>
  let withBoxes = true

  function onChangeHideBoundingBoxes(e) {
    withBoxes = !$(e.target).prop('checked')
    updateResults()
  }


  async function updateResults() {
    if (!isFaceDetectionModelLoaded()) {
      return
    }

    const inputImgEl = $('#inputImg').get(0)
    const options = getFaceDetectorOptions()

    const results = await faceapi.detectAllFaces(inputImgEl, options).withFaceLandmarks()
    console.log(results);
    var length = results[0].landmarks.relativePositions.length;
    console.log(length);
    var step = parseInt(results[0].landmarks.relativePositions.length / 12);
    console.log(step);
    var i;
    var j = 0;
    var k;
    var ll;
    var samenumflag = 0;
    var lottonum = new Array(6);
    console.log(lottonum);
    for (i = 0; i < length; i += step) {
      samenumflag = 0;
      console.log("i=" + i + ", j=" + j);
      // console.log(i);
      // console.log(results[0].landmarks.relativePositions[i].x);
      // console.log(results[0].landmarks.relativePositions[i].y);
      var xplusy = parseInt((results[0].landmarks.relativePositions[i].x + results[0].landmarks.relativePositions[i].y) * 200 % 45);
      console.log(xplusy);


      for (k = 0; k < j; k++) {
        if (lottonum[k] == xplusy) {
          console.log("find the same number at " + k, xplusy);
          samenumflag = 1;
        }


      }

      if (samenumflag == 0) {
        lottonum[j] = xplusy;
        j++;
      }

      if (j > 5)
        break;

      // var strnum = xplusy.toString();
      // console.log(strnum);
      // console.log(strnum[0]);
    }

    if (j > 5) {

      for (ll = 0; ll < 6; ll++) {
        console.log(lottonum[ll]);
      }

    } else {
      console.log("few numbers");
      for (ll = j; ll < 6; ll++) {
        lottonum[ll] = 45 - ll;
        console.log(lottonum[ll]);
      }
    }

    lottonum.sort(function (a, b) { // 오름차순
      return a - b;
      // 1, 2, 3, 4, 10, 11
    });

   // document.getElementById("print_lottonum").innerHTML = lottonum.toString();

    document.getElementById("span1_id").innerHTML = lottonum[0].toString();
    document.getElementById("span2_id").innerHTML = lottonum[1].toString();
    document.getElementById("span3_id").innerHTML = lottonum[2].toString();
    document.getElementById("span4_id").innerHTML = lottonum[3].toString();
    document.getElementById("span5_id").innerHTML = lottonum[4].toString();
    document.getElementById("span6_id").innerHTML = lottonum[5].toString();



    const canvas = $('#overlay').get(0)
    faceapi.matchDimensions(canvas, inputImgEl)
    const resizedResults = faceapi.resizeResults(results, inputImgEl)

    if (withBoxes) {
      faceapi.draw.drawDetections(canvas, resizedResults)
    }
    faceapi.draw.drawFaceLandmarks(canvas, resizedResults)
  }

  async function run() {
    // load face detection and face landmark models
    await changeFaceDetector(SSD_MOBILENETV1)
    await faceapi.loadFaceLandmarkModel('/')

    // start processing image
    updateResults()
  }

  $(document).ready(function () {
    // renderNavBar('#navbar', 'face_landmark_detection')
    initImageSelectionControls()
    initFaceDetectionControls()
    run()
  })
</script>
</body>

</html>